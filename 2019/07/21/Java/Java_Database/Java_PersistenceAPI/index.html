<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="en,default">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/icon.jpg?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/icon.jpg?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Java Persistence API JPAObject Relational MappingObject Relational Mapping (ORM) that maps object state to data in a relational database. Mismatch issues between OO and relational models exist and nee">
<meta name="keywords" content="Java,JPA">
<meta property="og:type" content="article">
<meta property="og:title" content="JPA Baisc">
<meta property="og:url" content="http://yoursite.com/2019/07/21/Java/Java_Database/Java_PersistenceAPI/index.html">
<meta property="og:site_name" content="Hi, Shihao">
<meta property="og:description" content="Java Persistence API JPAObject Relational MappingObject Relational Mapping (ORM) that maps object state to data in a relational database. Mismatch issues between OO and relational models exist and nee">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://yoursite.com/2019/07/21/Java/Java_Database/Java_PersistenceAPI/Entity_LifeCycle.png">
<meta property="og:updated_time" content="2019-10-19T23:46:25.477Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JPA Baisc">
<meta name="twitter:description" content="Java Persistence API JPAObject Relational MappingObject Relational Mapping (ORM) that maps object state to data in a relational database. Mismatch issues between OO and relational models exist and nee">
<meta name="twitter:image" content="http://yoursite.com/2019/07/21/Java/Java_Database/Java_PersistenceAPI/Entity_LifeCycle.png">






  <link rel="canonical" href="http://yoursite.com/2019/07/21/Java/Java_Database/Java_PersistenceAPI/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>JPA Baisc | Hi, Shihao</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div id="pjax-container" class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hi, Shihao</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-empire"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-notes">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-pencil"></i> <br>Notes</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-blog">

    
    
    
      
    

    

    <a href="/trace" rel="section"><i class="menu-item-icon fa fa-fw fa-angle-double-down"></i> <br>Blog</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tag">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-flask"></i> <br>Tag</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-timeline">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-backward"></i> <br>Timeline</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about-me">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-rebel"></i> <br>About-me</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/21/Java/Java_Database/Java_PersistenceAPI/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Shihao Miao">
      <meta itemprop="description" content="坠欢莫拾，酒痕在衣">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hi, Shihao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">JPA Baisc

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-07-21 18:06:52" itemprop="dateCreated datePublished" datetime="2019-07-21T18:06:52-04:00">2019-07-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-10-19 19:46:25" itemprop="dateModified" datetime="2019-10-19T19:46:25-04:00">2019-10-19</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Software-Development/" itemprop="url" rel="index"><span itemprop="name">Software Development</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Software-Development/Java-Programming/" itemprop="url" rel="index"><span itemprop="name">Java Programming</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Software-Development/Java-Programming/Data-Access/" itemprop="url" rel="index"><span itemprop="name">Data Access</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Java-Persistence-API-JPA"><a href="#Java-Persistence-API-JPA" class="headerlink" title="Java Persistence API JPA"></a>Java Persistence API JPA</h1><h2 id="Object-Relational-Mapping"><a href="#Object-Relational-Mapping" class="headerlink" title="Object Relational Mapping"></a>Object Relational Mapping</h2><p>Object Relational Mapping (ORM) that maps object state to data in a relational database.</p>
<p>Mismatch issues between OO and relational models exist and need to be taken into account: </p>
<ul>
<li>Subtyping: Fundamental to OO, absent in RDBMS </li>
<li>Granularity: One object’s data could be stored in multiple tables</li>
<li>Relationships: Associations in OO, foreign keys in RDBMS</li>
</ul>
<h2 id="Java-Persistence-API-JPA-1"><a href="#Java-Persistence-API-JPA-1" class="headerlink" title="Java Persistence API JPA"></a>Java Persistence API JPA</h2><p>JPA is a Java API specification for relational data management in applications using Java SE and Java EE. JPA defines a standard way for simplifying database programming for developers, reduce development time and increase productivity. When using JPA, you have to import interfaces and classes from the package javax.persistence.</p>
<p>JPA defines Java Persistence Query Language (JPQL) which is an object-oriented query language. The syntax of JPQL is similar to SQL but it operates against Java objects rather than directly with database tables.</p>
<p>JPA is a specification, and Hibernate is one of its implementations, among others such as EclipseLink and OpenJPA.</p>
<h2 id="Hibernate-Framework"><a href="#Hibernate-Framework" class="headerlink" title="Hibernate Framework"></a>Hibernate Framework</h2><p>Hibernate is a popular Object Relational Mapping (ORM) framework that aims at simplifying database programming for developers. Object Relational Mapping (ORM) that maps object state to data in a relational database.</p>
<h1 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h1><h2 id="Entity"><a href="#Entity" class="headerlink" title="Entity"></a>Entity</h2><p>Entity classes are the Object data we want to persist</p>
<p>Entity classes have following requirement:</p>
<ol>
<li>Entity class must be annotated with Entity or described in the XML configuration fie JPA</li>
<li>Entity class must contain a public or protecedconstructor with no arguments(It can also have constructors with arguments)</li>
<li>Entity class must be a top-level class</li>
<li>Entity class cannot be enum or interface</li>
<li>Enity class cannot be final class</li>
<li>Entity class cannot contain final fields or methods if they participate in mapping (persistent final methods or persistent final instance variables)</li>
<li>If an Entity class object is passed by values as a separate object(detached object), for example through a remote interface, it must also implement a serializable interface.</li>
<li>The Entity class fields should be directly accessible only to the methods of the Entity class and should not be directly accessible to other classes using this entity. Such classes should refer only to methods(getter/setter) methods or other business logic methods in the Entity class.</li>
<li>The Entity class must contain a primary key, that is, an attribute or group of attributes that uniquely defines the record of this Enity class in the database.</li>
</ol>
<h2 id="Entity-1"><a href="#Entity-1" class="headerlink" title="@Entity"></a>@Entity</h2><p>This annotation indicates that the class is mapped to a database table. By default, the ORM framework understands that the class name is as same as the table name. The @Entity annotation must be placed before the class definition.</p>
<h1 id="Id"><a href="#Id" class="headerlink" title="@Id"></a>@Id</h1><p>This annotation specifies that a field is mapped to a primary key column in the table. </p>
<p><strong>Example 1</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// Entity annotation</span><br><span class="line">@Entity</span><br><span class="line">public class Employee&#123;</span><br><span class="line">    // Mandatory Id with Id annotation</span><br><span class="line">    @Id </span><br><span class="line">    private int empId;</span><br><span class="line">    private String empName;</span><br><span class="line">    // Mandatory non-argument constructor</span><br><span class="line">    public Employee()&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Table"><a href="#Table" class="headerlink" title="@Table"></a>@Table</h2><p>This annotation is used if the class name is different than the database table name, and it is must placed before the class definition. </p>
<h2 id="Column"><a href="#Column" class="headerlink" title="@Column"></a>@Column</h2><p>This annotation is used to map an instance field of the class to a column in the database table</p>
<h2 id="Transient"><a href="#Transient" class="headerlink" title="@Transient"></a>@Transient</h2><p>This annotation is used to ignore the data when storing in the SQL<br><strong>Example 2</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Entity</span><br><span class="line">// Optional to give the table name</span><br><span class="line">@Table(name= &quot;EMP&quot;)</span><br><span class="line">public class Employee&#123;</span><br><span class="line">    @Id</span><br><span class="line">    // Optional to give column name</span><br><span class="line">    @Column(name = &quot;EMP_ID&quot;)</span><br><span class="line">    private int empIdl</span><br><span class="line">    @Column(name = &quot;EMP_NAME&quot;)</span><br><span class="line">    private String empName;  </span><br><span class="line">    //  Transient annotation to ask not to write this data</span><br><span class="line">    @Transient</span><br><span class="line">    private int age; </span><br><span class="line">    public Employee()&#123;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Create-JPA-Configuration-File-persistence-xml"><a href="#Create-JPA-Configuration-File-persistence-xml" class="headerlink" title="Create JPA Configuration File (persistence.xml)"></a>Create JPA Configuration File (persistence.xml)</h2><p>An XML configuration file for JPA called persistence.xml is required to tell Hibernate how to connect to the database. This file must be present in the classpath, under the META-INF folder.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;persistence version=&quot;2.1&quot; xmlns=&quot;http://xmlns.jcp.org/xml/ns/persistence&quot;</span><br><span class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">    xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/persistence</span><br><span class="line">        http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd&quot;&gt;</span><br><span class="line">    &lt;persistence-unit name=&quot;UsersDB&quot;&gt;</span><br><span class="line">        &lt;properties&gt;</span><br><span class="line">            &lt;property name=&quot;javax.persistence.jdbc.url&quot; value=&quot;jdbc:mysql://localhost:3306/usersdb&quot; /&gt;</span><br><span class="line">            &lt;property name=&quot;javax.persistence.jdbc.user&quot; value=&quot;root&quot; /&gt;</span><br><span class="line">            &lt;property name=&quot;javax.persistence.jdbc.password&quot; value=&quot;P@ssw0rd&quot; /&gt;</span><br><span class="line">            &lt;property name=&quot;javax.persistence.jdbc.driver&quot; value=&quot;com.mysql.jdbc.Driver&quot; /&gt;</span><br><span class="line">            &lt;property name=&quot;hibernate.show_sql&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">            &lt;property name=&quot;hibernate.format_sql&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">        &lt;/properties&gt;</span><br><span class="line">    &lt;/persistence-unit&gt;</span><br><span class="line">&lt;/persistence&gt;</span><br></pre></td></tr></table></figure>
<p>The values for url, user, and password are changed accordingly.</p>
<h2 id="Key-Interfaces-and-Classes"><a href="#Key-Interfaces-and-Classes" class="headerlink" title="Key Interfaces and Classes"></a>Key Interfaces and Classes</h2><h3 id="Persistence"><a href="#Persistence" class="headerlink" title="Persistence"></a>Persistence</h3><p>Javax.persistence is the only class available in JPA. Persistence is the starting point for JPA implementation.</p>
<p>Persistence creates <strong>EntityManagerFactory</strong> instances.</p>
<h3 id="Entity-ManagerFactory"><a href="#Entity-ManagerFactory" class="headerlink" title="Entity ManagerFactory"></a>Entity ManagerFactory</h3><p>An EntityManagerFactory is used to create an <strong>EntityManager</strong>. And EntityManagerFactory is associated with a persistence unit. </p>
<h3 id="Entity-Manager"><a href="#Entity-Manager" class="headerlink" title="Entity Manager"></a>Entity Manager</h3><p>An EntityManager instance is associated with a persistence context, and it is used to interact with the database. A persistence context is a set of entity instances, which are actually the objects or instances of the model classes. </p>
<p>The EntityManager is used to manage entity instances and their life cycle, such as create entities, update entities, remove entities, find and query entities.</p>
<h3 id="Entity-Transaction"><a href="#Entity-Transaction" class="headerlink" title="Entity Transaction"></a>Entity Transaction</h3><p>Entity Transaction groups operations on persistent data into units of work that completely succeed or fail.</p>
<h1 id="Entity-LifeCycle"><a href="#Entity-LifeCycle" class="headerlink" title="Entity LifeCycle"></a>Entity LifeCycle</h1><p><img src="Entity_LifeCycle.png" alt="Entity_LifeCycle Picture" style="float: left; margin-right: 10px;"></p>
<h3 id="Trasient-New"><a href="#Trasient-New" class="headerlink" title="Trasient(New)"></a>Trasient(New)</h3><ul>
<li>A newly created object that hasn’t been associated with persistence context and is not mapped to any database below</li>
</ul>
<h3 id="Managerd-Persisted"><a href="#Managerd-Persisted" class="headerlink" title="Managerd (Persisted)"></a>Managerd (Persisted)</h3><ul>
<li>To convert transient object to be managed by calling the persist().</li>
<li>Persistent entity has been associated with a database table row and is being managed by current running persistence context.</li>
</ul>
<h3 id="Detached"><a href="#Detached" class="headerlink" title="Detached"></a>Detached</h3><ul>
<li>Detached represents entity objects that have been disconnected from EntityManager</li>
<li>Once The current running persistence context is closed all previously managed entities becomes detached.</li>
</ul>
<h3 id="Merge"><a href="#Merge" class="headerlink" title="Merge"></a>Merge</h3><ul>
<li>Opposite to detached. It helps disconnected entity object to merge back to managed entities </li>
</ul>
<h3 id="Removed"><a href="#Removed" class="headerlink" title="Removed"></a>Removed</h3><p>Only the managed entities are allowed to be removed. The remove process in actual database will be executed during flush(). The flush() in Java is called by using commit().</p>
<h1 id="Implementation-in-Java"><a href="#Implementation-in-Java" class="headerlink" title="Implementation in Java"></a>Implementation in Java</h1><h2 id="Persistence-Context"><a href="#Persistence-Context" class="headerlink" title="Persistence Context"></a>Persistence Context</h2><ol>
<li>The persistence context is the set of Entity instances in the application, managed by the EntityManager.</li>
<li>Each EntityManger instance is associated with a persistence context</li>
<li>The EntityManger interface defines the methods that are used to interact with the persistence context.</li>
</ol>
<p>A persistence unit is used to configure:</p>
<pre><code>- Which Entit classes are to be managed
- Persistence provider details
- Database connection details and other properties
</code></pre><h2 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h2><ol>
<li>Start a new Java Project.</li>
<li>Convert the new Java Project to Maven Project by right click -&gt; configure.</li>
<li>Add following dependency into pom.xml file<ol>
<li>hibernate-core</li>
<li>hibernate-c3p0  (This is for connection pool)</li>
<li>ojdbc6</li>
</ol>
</li>
<li>Right click of the project -&gt; property -&gt; Project Facets -&gt; check the JPA -&gt; Further configuration required -&gt; Disable Library</li>
<li>Add a persistence.xml file to the META-INF folder.<ul>
<li>An XML file that <strong>defines persistence units</strong></li>
<li>Should be placed in a directory called META-INF</li>
</ul>
</li>
</ol>
<h2 id="implementation"><a href="#implementation" class="headerlink" title="implementation"></a>implementation</h2><p>The typical steps to manage entity instances via JPA:</p>
<ol>
<li>Get an EntityanagerFactory from the class Persistence<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EntityManagerFactory emFactory = Persistence.createEntityManagerFactory(&quot;PersistenceUnitName&quot;);</span><br><span class="line">// PersistenceUnitName could be find from persistence.xml</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>It will be configured according to details in the given persistence units</p>
<ol start="2">
<li>Once a factory is in place, EntityManager instances can be obtained:</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EntityManager em = emFactory.createEntityManager();</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>Managing Entities<br>Finding by ID<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Employee employee = em.find(Employee.class, 158)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>Persisting<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Employee employee = new Employee(158);</span><br><span class="line">em.getTransaction().begin();</span><br><span class="line">em.persist(employee);</span><br><span class="line">em.getTransaction().commit();</span><br></pre></td></tr></table></figure></p>
<p>Deleting<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Employee employee = em.find(Employee.class, 158);</span><br><span class="line">em.getTransaction().begin();</span><br><span class="line">em.remove(employee);</span><br><span class="line">em.getTransaction().commit();</span><br></pre></td></tr></table></figure></p>
<p>Update<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Employee employee = em.find(Employee.class, 158);</span><br><span class="line">em.getTransaction().begin();</span><br><span class="line">employee.setSalary(50000)</span><br><span class="line">em.getTransaction().commit();</span><br></pre></td></tr></table></figure></p>
<p>detach and merge<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Employee pojoEmployee = new Employee(158);</span><br><span class="line">em.detach(pojoEmployee)</span><br><span class="line">em.getTransaction().begin();</span><br><span class="line">Employee managedEmployee = em.merge(pojoEmployee);</span><br><span class="line">em.getTransaction().commit();</span><br></pre></td></tr></table></figure></p>
<h1 id="Java-Persistence-Query-Language-JPQL"><a href="#Java-Persistence-Query-Language-JPQL" class="headerlink" title="Java Persistence Query Language (JPQL)"></a>Java Persistence Query Language (JPQL)</h1><p>Query finds persistent objects that meet certain criteria. It allows use of both Java Persistency Query Language(JPQL) and Structured Query Language(SQL). The implementation of it is vendor specific.</p>
<p>Java persistence API provides JPQL for querying entites.</p>
<p>The methods used to query the entities using JPQL are</p>
<ul>
<li>createQuery()</li>
<li>createNamedQery()</li>
<li>createNativeQuery()</li>
<li>createStoredProcedureQuery()</li>
</ul>
<h2 id="Dynamic-Queries-createQuery"><a href="#Dynamic-Queries-createQuery" class="headerlink" title="Dynamic Queries createQuery()"></a>Dynamic Queries createQuery()</h2><p>Dynamic queries defines directly within an application’s business logic.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Query query = em.createQuery(&quot;SELECT e FROM Employee e&quot;, Employee.class&quot;)</span><br><span class="line">List&lt;Employee&gt; allEmployees = query.getResultList();</span><br></pre></td></tr></table></figure>
<h2 id="Static-Queries-createNamedQuery"><a href="#Static-Queries-createNamedQuery" class="headerlink" title="Static Queries - createNamedQuery ()"></a>Static Queries - createNamedQuery ()</h2><p>static queries are defined in metadata by using the @NamedQuery annotation. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@NamedQuery(</span><br><span class="line">   	 name=&quot;findAllCustomersWithName&quot;,</span><br><span class="line">   	 query=&quot;SELECT c FROM Customer c WHERE c.name LIKE :custName&quot;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">em.createNamedQuery(&quot;findAllCustomersWithName&quot;);</span><br></pre></td></tr></table></figure>
<h2 id="Parameter"><a href="#Parameter" class="headerlink" title="Parameter"></a>Parameter</h2><h3 id="Named-Parameters"><a href="#Named-Parameters" class="headerlink" title="Named Parameters:"></a>Named Parameters:</h3><p>Query parameters that are prefixed with a colon (:).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Dynamic Queries - createQuery()</span><br><span class="line">public List findWithName(String Name)&#123;</span><br><span class="line">    Query query =em.createQuery(&quot;SELECT c FROM Customer c WHERE c.name LIKE:custName&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Positional-Parameters"><a href="#Positional-Parameters" class="headerlink" title="Positional Parameters:"></a>Positional Parameters:</h3><p>Prefixed with a question mark (?) followed the numeric position of the parameter in the query.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public List findWithName(String name) &#123; </span><br><span class="line"></span><br><span class="line">	Query query = em.createQuery( “SELECT c FROM 			Customer c WHERE c.name LIKE ? 1”);</span><br><span class="line">	query.setParameter(1, name) </span><br><span class="line">	return query.getResultList(); </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
            <a href="/tags/JPA/" rel="tag"># JPA</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/07/17/JavaScript/JavaScript_Function_and_Block_Scope/" rel="next" title="JavaScript(2) Function and Scope">
                <i class="fa fa-chevron-left"></i> JavaScript(2) Function and Scope
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/07/23/Java/Java_Database/Java_persistenceAPI2/" rel="prev" title="JPA Study Notes(2)">
                JPA Study Notes(2) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Shihao Miao</p>
              <div class="site-description motion-element" itemprop="description">坠欢莫拾，酒痕在衣</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives">
                
                    <span class="site-state-item-count">70</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">14</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">16</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/Miaooocat" title="GitHub &rarr; https://github.com/Miaooocat" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:miao.shihaoo@gmail.com" title="E-Mail &rarr; mailto:miao.shihaoo@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Java-Persistence-API-JPA"><span class="nav-number">1.</span> <span class="nav-text">Java Persistence API JPA</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Object-Relational-Mapping"><span class="nav-number">1.1.</span> <span class="nav-text">Object Relational Mapping</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java-Persistence-API-JPA-1"><span class="nav-number">1.2.</span> <span class="nav-text">Java Persistence API JPA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hibernate-Framework"><span class="nav-number">1.3.</span> <span class="nav-text">Hibernate Framework</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Architecture"><span class="nav-number">2.</span> <span class="nav-text">Architecture</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Entity"><span class="nav-number">2.1.</span> <span class="nav-text">Entity</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Entity-1"><span class="nav-number">2.2.</span> <span class="nav-text">@Entity</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Id"><span class="nav-number">3.</span> <span class="nav-text">@Id</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Table"><span class="nav-number">3.1.</span> <span class="nav-text">@Table</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Column"><span class="nav-number">3.2.</span> <span class="nav-text">@Column</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Transient"><span class="nav-number">3.3.</span> <span class="nav-text">@Transient</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Create-JPA-Configuration-File-persistence-xml"><span class="nav-number">3.4.</span> <span class="nav-text">Create JPA Configuration File (persistence.xml)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Key-Interfaces-and-Classes"><span class="nav-number">3.5.</span> <span class="nav-text">Key Interfaces and Classes</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Persistence"><span class="nav-number">3.5.1.</span> <span class="nav-text">Persistence</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Entity-ManagerFactory"><span class="nav-number">3.5.2.</span> <span class="nav-text">Entity ManagerFactory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Entity-Manager"><span class="nav-number">3.5.3.</span> <span class="nav-text">Entity Manager</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Entity-Transaction"><span class="nav-number">3.5.4.</span> <span class="nav-text">Entity Transaction</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Entity-LifeCycle"><span class="nav-number">4.</span> <span class="nav-text">Entity LifeCycle</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Trasient-New"><span class="nav-number">4.0.1.</span> <span class="nav-text">Trasient(New)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Managerd-Persisted"><span class="nav-number">4.0.2.</span> <span class="nav-text">Managerd (Persisted)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Detached"><span class="nav-number">4.0.3.</span> <span class="nav-text">Detached</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Merge"><span class="nav-number">4.0.4.</span> <span class="nav-text">Merge</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Removed"><span class="nav-number">4.0.5.</span> <span class="nav-text">Removed</span></a></li></ol></li></ol><li class="nav-item nav-level-1"><a class="nav-link" href="#Implementation-in-Java"><span class="nav-number">5.</span> <span class="nav-text">Implementation in Java</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Persistence-Context"><span class="nav-number">5.1.</span> <span class="nav-text">Persistence Context</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Configuration"><span class="nav-number">5.2.</span> <span class="nav-text">Configuration</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#implementation"><span class="nav-number">5.3.</span> <span class="nav-text">implementation</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Java-Persistence-Query-Language-JPQL"><span class="nav-number">6.</span> <span class="nav-text">Java Persistence Query Language (JPQL)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Dynamic-Queries-createQuery"><span class="nav-number">6.1.</span> <span class="nav-text">Dynamic Queries createQuery()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Static-Queries-createNamedQuery"><span class="nav-number">6.2.</span> <span class="nav-text">Static Queries - createNamedQuery ()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Parameter"><span class="nav-number">6.3.</span> <span class="nav-text">Parameter</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Named-Parameters"><span class="nav-number">6.3.1.</span> <span class="nav-text">Named Parameters:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Positional-Parameters"><span class="nav-number">6.3.2.</span> <span class="nav-text">Positional Parameters:</span></a></li></ol></li></ol></li></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Shihao Miao</span>

  

  
</div>

<div>
<span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("03/20/2019 00:00:00");
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已经在各种报错下不安全的运行了 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分钟 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>



  <span class="post-meta-divider">|</span>






        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>







  




















  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=7.0.1"></script>



  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>

  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>



  <script src="//cdn.bootcss.com/jquery.pjax/1.9.6/jquery.pjax.js"></script>
<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>
<script type="text/javascript">

$(document).on('pjax:start', NProgress.start).on('pjax:end', NProgress.done);
$(document).pjax('a[target!="_blank"]', '#pjax-container', {timeout: 8000, fragment: '#pjax-container'});
$(document).on('pjax:complete', function () {

  NexT.motion.integrator.cursor = -1;

  $(document).trigger('bootstrap:before');
  
  //NexT.utils.isMobile() && window.FastClick.attach(document.body);

  NexT.utils.lazyLoadPostsImages();

  NexT.utils.registerBackToTop();

  $('.site-nav-toggle button').on('click', function () {
    var $siteNav = $('.site-nav');
    var ON_CLASS_NAME = 'site-nav-on';
    var isSiteNavOn = $siteNav.hasClass(ON_CLASS_NAME);
    var animateAction = isSiteNavOn ? 'slideUp' : 'slideDown';
    var animateCallback = isSiteNavOn ? 'removeClass' : 'addClass';

    $siteNav.stop()[animateAction]('fast', function () {
      $siteNav[animateCallback](ON_CLASS_NAME);
    });
  });

  CONFIG.fancybox && NexT.utils.wrapImageWithFancyBox();
  NexT.utils.embeddedVideoTransformer();


  $(document).trigger('motion:before');

  NexT.motion.init();
  if (CONFIG.motion) {
    $('.archive-year').velocity('transition.slideLeftIn');
    CONFIG.motion && NexT.motion.integrator.bootstrap();
  }
  NexT.postDetails.init();
  $(document).trigger('bootstrap:after');
});
</script>
  
  

  

  

  


  


  




  

  

  
  

  
  

  


  

  

  

  

  

  

  

  

  
<script>
  $('.highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('Copy').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('Copy');
      }, 300);
    }).append(e);
  })
</script>


  

  

  
<link rel="stylesheet" href="/dist/APlayer.min.css">
<div id="aplayer"></div>
<script type="text/javascript" src="/dist/APlayer.min.js"></script>
<script type="text/javascript" src="/dist/music.js"></script>
<script type="text/javascript" src="/js/src/crash_cheat.js"></script>
</body>
</html>
